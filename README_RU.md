# Парсер мероприятий

Приложение на Java для парсинга мероприятий из открытых источников (сайты, соцсети), обработки данных и сохранения в PostgreSQL.

## Функциональность

- **Парсинг мероприятий**
  - Парсинг мероприятий с веб-сайтов с использованием Jsoup
  - Извлечение деталей мероприятий (название, дата, место, цена, количество участников, контакты организаторов)
  - Многопоточный парсинг для повышения производительности

- **Отправка сообщений**
  - Автоматическая отправка сообщений организаторам через:
    - Email (JavaMail)
    - Telegram (Telegram Bot API)
  - Логирование статуса сообщений (успех/ошибка)

- **Интеграция с PostgreSQL**
  - Хранение мероприятий со всеми необходимыми деталями
  - Отслеживание статуса отправки сообщений и ответов

- **Telegram-бот**
  - Отправка сообщений организаторам
  - Отслеживание ответов и обновление базы данных

## Технологический стек

- Java 11
- Spring Boot 2.7
- PostgreSQL + Hibernate/JPA
- Jsoup (парсинг HTML)
- Telegram Bot API
- JavaMail
- Maven

## Установка и настройка

### Что вам потребуется

Для запуска приложения вам потребуется:

1. **JDK 11 или выше**
   - Скачайте и установите с [Oracle](https://www.oracle.com/java/technologies/javase-jdk11-downloads.html) или используйте OpenJDK

2. **Maven**
   - Скачайте с [официального сайта](https://maven.apache.org/download.cgi) и установите
   - Или используйте встроенный Maven в вашей IDE (IntelliJ IDEA, Eclipse)

3. **PostgreSQL**
   - Скачайте и установите с [официального сайта](https://www.postgresql.org/download/)
   - Создайте базу данных для приложения (см. инструкции ниже)

4. **Telegram-бот**
   - Создайте бота через [@BotFather](https://t.me/BotFather) в Telegram
   - Получите токен бота и имя пользователя

5. **Учетная запись электронной почты**
   - Для Gmail потребуется создать пароль приложения в настройках безопасности

### Настройка PostgreSQL

1. Установите PostgreSQL, следуя инструкциям для вашей операционной системы
2. После установки создайте базу данных:
   ```sql
   CREATE DATABASE eventparser;
   ```
3. Создайте пользователя или используйте существующего (по умолчанию 'postgres')
4. Запомните имя пользователя, пароль и название базы данных для настройки приложения

### Создание Telegram-бота

1. Откройте Telegram и найдите [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям, чтобы создать нового бота:
   - Укажите имя бота (например, "Event Parser Bot")
   - Укажите имя пользователя бота (должно заканчиваться на "bot", например, "event_parser_bot")
4. BotFather предоставит вам токен бота - **сохраните его**
5. Запомните имя пользователя бота (без символа @) и токен для настройки приложения

### Настройка Email

Для использования Gmail:

1. Войдите в свой аккаунт Google
2. Перейдите в [Настройки безопасности](https://myaccount.google.com/security)
3. Включите двухфакторную аутентификацию, если она еще не включена
4. Создайте пароль приложения:
   - Выберите "Пароли приложений"
   - Выберите приложение "Другое (указать название)" и введите "Event Parser"
   - Нажмите "Создать"
   - Скопируйте сгенерированный пароль - **это ваш пароль приложения**
5. Запомните свой email и пароль приложения для настройки приложения

### Настройка приложения

Отредактируйте файл `src/main/resources/application.properties`:

1. **Настройки базы данных**
   ```properties
   spring.datasource.url=jdbc:postgresql://localhost:5432/eventparser
   spring.datasource.username=ваш_пользователь_postgres
   spring.datasource.password=ваш_пароль_postgres
   ```

2. **Настройки электронной почты**
   ```properties
   spring.mail.host=smtp.gmail.com
   spring.mail.port=587
   spring.mail.username=ваш_email@gmail.com
   spring.mail.password=ваш_пароль_приложения
   ```

3. **Настройки Telegram-бота**
   ```properties
   telegram.bot.username=имя_пользователя_вашего_бота
   telegram.bot.token=токен_вашего_бота
   ```

4. **Настройки парсинга**
   ```properties
   parser.sources=https://www.meetup.com/find/events/, https://www.eventbrite.com/d/online/all-events/
   ```
   Укажите URL-адреса сайтов, с которых хотите парсить мероприятия.

## Сборка приложения

```bash
mvn clean package
```

## Запуск приложения

```bash
java -jar target/event-parser-1.0-SNAPSHOT.jar
```

## Запуск с использованием Docker

### Установка Docker

1. Скачайте и установите Docker с [официального сайта](https://www.docker.com/products/docker-desktop)
2. Убедитесь, что Docker запущен

### Сборка Docker-образа

```bash
docker build -t event-parser .
```

### Запуск контейнера

```bash
docker run -p 8080:8080 event-parser
```

## Чеклист данных, которые нужно предоставить

Перед запуском приложения убедитесь, что у вас есть:

1. **Для базы данных PostgreSQL**:
   - [ ] URL базы данных (обычно `jdbc:postgresql://localhost:5432/eventparser`)
   - [ ] Имя пользователя PostgreSQL
   - [ ] Пароль пользователя PostgreSQL

2. **Для электронной почты**:
   - [ ] SMTP-сервер (для Gmail: `smtp.gmail.com`)
   - [ ] Порт SMTP-сервера (для Gmail: `587`)
   - [ ] Ваш email-адрес
   - [ ] Пароль приложения (для Gmail) или обычный пароль

3. **Для Telegram-бота**:
   - [ ] Имя пользователя бота (без символа @)
   - [ ] Токен бота (полученный от @BotFather)

4. **Для парсинга**:
   - [ ] URL-адреса сайтов для парсинга мероприятий

## Настройка парсинга для конкретных сайтов

Текущая реализация парсера (`WebsiteEventParser`) является общей и может потребовать настройки для конкретных сайтов. Для настройки парсера для определенного сайта:

1. Изучите HTML-структуру сайта, используя инструменты разработчика в браузере
2. Настройте CSS-селекторы в методе `parseEvents` класса `WebsiteEventParser`
3. При необходимости добавьте дополнительные форматы дат в метод `parseDate`

## Возможные проблемы и их решения

### База данных
- **Ошибка подключения к базе данных**: Убедитесь, что PostgreSQL запущен и доступен по указанному URL
- **Ошибка аутентификации**: Проверьте правильность имени пользователя и пароля

### Telegram-бот
- **Бот не отвечает**: Убедитесь, что токен бота указан правильно
- **Ошибка инициализации бота**: Проверьте, что имя пользователя бота указано без символа @

### Email
- **Ошибка аутентификации**: Для Gmail убедитесь, что вы используете пароль приложения, а не обычный пароль
- **Ошибка подключения к SMTP-серверу**: Проверьте настройки SMTP-сервера и порта

### Парсинг
- **Не удается спарсить мероприятия**: Сайт может изменить свою HTML-структуру, потребуется обновить CSS-селекторы
- **Ошибка подключения к сайту**: Сайт может блокировать запросы, попробуйте изменить User-Agent или добавить задержку между запросами